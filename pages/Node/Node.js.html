<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node.js | 郑天霸的技术博客丨🥩</title>
    <meta name="description" content="温故而知新丶">
    <meta name="generator" content="VuePress 1.3.1">
    <link rel="icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.e93f68ab.css" as="style"><link rel="preload" href="/assets/js/app.ac713374.js" as="script"><link rel="preload" href="/assets/js/2.0cae008b.js" as="script"><link rel="preload" href="/assets/js/25.98184248.js" as="script"><link rel="prefetch" href="/assets/js/10.abedb6b3.js"><link rel="prefetch" href="/assets/js/11.57e0b600.js"><link rel="prefetch" href="/assets/js/12.d767401c.js"><link rel="prefetch" href="/assets/js/13.f4a6be0a.js"><link rel="prefetch" href="/assets/js/14.d2d17fdf.js"><link rel="prefetch" href="/assets/js/15.8ff5a63c.js"><link rel="prefetch" href="/assets/js/16.e4fe40bd.js"><link rel="prefetch" href="/assets/js/17.6cf7a56e.js"><link rel="prefetch" href="/assets/js/18.5e78c843.js"><link rel="prefetch" href="/assets/js/19.64ed0aaa.js"><link rel="prefetch" href="/assets/js/20.8ef24e45.js"><link rel="prefetch" href="/assets/js/21.9ff94ede.js"><link rel="prefetch" href="/assets/js/22.39fdaa77.js"><link rel="prefetch" href="/assets/js/23.1943ee9a.js"><link rel="prefetch" href="/assets/js/24.20459581.js"><link rel="prefetch" href="/assets/js/26.84555e21.js"><link rel="prefetch" href="/assets/js/27.989de408.js"><link rel="prefetch" href="/assets/js/28.86216cdd.js"><link rel="prefetch" href="/assets/js/29.38c4262a.js"><link rel="prefetch" href="/assets/js/3.6f5f7539.js"><link rel="prefetch" href="/assets/js/30.6d90a099.js"><link rel="prefetch" href="/assets/js/31.eae386a1.js"><link rel="prefetch" href="/assets/js/32.59691217.js"><link rel="prefetch" href="/assets/js/33.eac12a5f.js"><link rel="prefetch" href="/assets/js/34.58a79c5e.js"><link rel="prefetch" href="/assets/js/35.7348d5e6.js"><link rel="prefetch" href="/assets/js/36.4e6a3a0c.js"><link rel="prefetch" href="/assets/js/37.6ea382c3.js"><link rel="prefetch" href="/assets/js/38.480b5662.js"><link rel="prefetch" href="/assets/js/4.a9af6ba7.js"><link rel="prefetch" href="/assets/js/5.273e332d.js"><link rel="prefetch" href="/assets/js/6.bc1d42cb.js"><link rel="prefetch" href="/assets/js/7.500983c6.js"><link rel="prefetch" href="/assets/js/8.d8445f88.js"><link rel="prefetch" href="/assets/js/9.48f102bc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e93f68ab.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">郑天霸的技术博客丨🥩</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/Xanadu-zxl" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/5b1228ccf265da6e0b6ff25e" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/Xanadu-zxl" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://juejin.im/user/5b1228ccf265da6e0b6ff25e" target="_blank" rel="noopener noreferrer" class="nav-link external">
  掘金
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>📐 CSS</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/CSS/cssWorld.html" class="sidebar-link">📏 Css世界</a></li><li><a href="/pages/CSS/cssBasis.html" class="sidebar-link">📏 Css知多少丶</a></li><li><a href="/pages/CSS/Less.html" class="sidebar-link">📏 Less</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>🔫 Frame</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/Frame/React.html" class="sidebar-link">⛳ React起飞</a></li><li><a href="/pages/Frame/Vue.html" class="sidebar-link">⛳ Vue起飞</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>🖇 HTML</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/HTML/H5_CSS3.html" class="sidebar-link">📎 H5 and CSS3</a></li><li><a href="/pages/HTML/HTML.html" class="sidebar-link">📎 HTML复习</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>📪 HTTP</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/HTTP/http.html" class="sidebar-link">HTTP协议丶</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>💻 JavaScript</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/JavaScript/Ajax-Json.html" class="sidebar-link">🍦 AJ</a></li><li><a href="/pages/JavaScript/Arrow.html" class="sidebar-link">🍦 箭头函数</a></li><li><a href="/pages/JavaScript/ES6.html" class="sidebar-link">🍦 ES6</a></li><li><a href="/pages/JavaScript/JavaScript.html" class="sidebar-link">🍦 JS基础丶</a></li><li><a href="/pages/JavaScript/Jquery.html" class="sidebar-link">🍦 Jquery</a></li><li><a href="/pages/JavaScript/JS_Advance.html" class="sidebar-link">🍦 JS进阶</a></li><li><a href="/pages/JavaScript/JS_Design_Mode.html" class="sidebar-link">🍦 JS设计模式</a></li><li><a href="/pages/JavaScript/JS_Object.html" class="sidebar-link">🍦 JS面向对象</a></li><li><a href="/pages/JavaScript/JS_RegExp.html" class="sidebar-link">🍦 JS正则</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>🎋 Node</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/Node/Node.js.html" class="active sidebar-link">💣 Node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#node-js-全局，核心对象，异步io" class="sidebar-link">node.js{全局，核心对象，异步IO}</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#分类" class="sidebar-link">分类</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#process（全局对象）" class="sidebar-link">process（全局对象）</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#filename-dirname（全局对象）" class="sidebar-link">filename/dirname（全局对象）</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#node-js实现规范" class="sidebar-link">node.js实现规范</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#核心对象path" class="sidebar-link">核心对象path</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#node-js是什么" class="sidebar-link">Node.js是什么?</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#事件驱动" class="sidebar-link">事件驱动</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#cpu密集-vs-i-o密集" class="sidebar-link">CPU密集 VS I/O密集</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#web常见场景" class="sidebar-link">web常见场景</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#高并发应对之道" class="sidebar-link">高并发应对之道</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#常用场景" class="sidebar-link">常用场景</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#nodejs工作模型" class="sidebar-link">NodeJs工作模型</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#nodejs的单线程" class="sidebar-link">NodeJS的单线程</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#commonsjs" class="sidebar-link">CommonsJS</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#require规则" class="sidebar-link">require规则</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#require特性" class="sidebar-link">require特性</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#fs案例" class="sidebar-link">FS案例</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#npm-包位置" class="sidebar-link">npm 包位置</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#http" class="sidebar-link">HTTP</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#express框架" class="sidebar-link">express框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#模板引擎" class="sidebar-link">模板引擎</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#mongodb" class="sidebar-link">MongoDB</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#条件查询" class="sidebar-link">条件查询</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#分页" class="sidebar-link">分页</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#排序" class="sidebar-link">排序</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#模糊匹配" class="sidebar-link">模糊匹配</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#聚合函数" class="sidebar-link">聚合函数</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#联合查询" class="sidebar-link">联合查询</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#操作符" class="sidebar-link">操作符</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#配置https" class="sidebar-link">配置https</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#扩展知识（使用mongodb实现附近的人）" class="sidebar-link">扩展知识（使用mongodb实现附近的人）</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#查找附近的人" class="sidebar-link">查找附近的人</a></li><li class="sidebar-sub-header"><a href="/pages/Node/Node.js.html#离我最近" class="sidebar-link">离我最近</a></li></ul></li></ul></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>🎏 Interview</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/Interview/FE_Interview.html" class="sidebar-link">🐷 前端面试技巧</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>🎮 杂七杂八</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/个人项目.html" class="sidebar-link">🔩项目</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>🎨 其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/Rests/chrome.html" class="sidebar-link">🔮 Chrome 技巧</a></li><li><a href="/pages/Rests/Git and npm.html" class="sidebar-link">🔮 Git 命令</a></li><li><a href="/pages/Rests/Hexo.html" class="sidebar-link">🔮 Hexo 入门</a></li><li><a href="/pages/Rests/Sublime_Text3.html" class="sidebar-link">🔮 Subleme_text3</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>🎯 周记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/Week/weekly_1.html" class="sidebar-link">周记一</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><p>Node.js
</p> <h1 id="珠峰"><a href="#珠峰" class="header-anchor">#</a> 珠峰</h1> <h2 id="node-js-全局，核心对象，异步io"><a href="#node-js-全局，核心对象，异步io" class="header-anchor">#</a> node.js{全局，核心对象，异步IO}</h2> <h3 id="分类"><a href="#分类" class="header-anchor">#</a> 分类</h3> <ul><li>全局对象:  何时何处都能访问</li> <li>核心对象:  向系统索要,引入即可使用</li> <li>自定义对象:  按路径引入即可</li></ul> <h3 id="process（全局对象）"><a href="#process（全局对象）" class="header-anchor">#</a> process（全局对象）</h3> <ul><li>每个系统的环境变量几乎都不一样，可以利用环境变量中的具体某个特定的值来区分不同的机器</li> <li>process.env 是一个对象，我们可以通过其.属性名来获取具体的环境变量值
<ul><li>设置一个特定的环境变量,以达到简单区分不同的机器,从而针对生产/开发环境运行不同的效果</li></ul></li> <li>process.argv 获取命令行参数</li></ul> <h3 id="filename-dirname（全局对象）"><a href="#filename-dirname（全局对象）" class="header-anchor">#</a> filename/dirname（全局对象）</h3> <ul><li>__filename 获取当前运行文件的目录,绝对路径</li> <li>__dirname 当前运行文件的绝对路径</li></ul> <h3 id="node-js实现规范"><a href="#node-js实现规范" class="header-anchor">#</a> node.js实现规范</h3> <ul><li>CommonJS   :  规范JavaScript语言作为后端语言运行的标准
<ul><li>具备什么能力,该怎么做 ,比如: 具备服务器的功能/  可以操作文件 .....</li> <li>模块应该怎么写: Module :
<ul><li>1:依赖一个模块   require('模块名(id)')</li> <li>2: 需要被模块依赖   module.exports = 给外部的数据</li> <li>3:一个文件是一个模块</li></ul></li></ul></li></ul> <h3 id="核心对象path"><a href="#核心对象path" class="header-anchor">#</a> 核心对象path</h3> <ul><li><code>const path = require('path');</code></li> <li>路径 -&gt; 在处理路径的时候很擅长,但是,其不负责判断路径是否存在文件</li> <li>拼接并修正路径 <code>path.join(__dirname,'a','b');</code> 以当前目录/a/b</li> <li><code>path.resovle('./xxx') 相对转绝对</code></li> <li>接收一个合法的路径字符串，转换成一个对象</li> <li><code>let pathObj = path.parse(mypath);</code></li> <li>接收一个路径对象，转换成一个字符串路径</li> <li><code>let str = path.format(pathObj);</code></li></ul> <div class="language-javascript line-numbers-mode"><pre class="language-javascript"><code><span class="token punctuation">{</span> root<span class="token operator">:</span> <span class="token string">'C:\\'</span><span class="token punctuation">,</span>
  dir<span class="token operator">:</span> <span class="token string">'C:\\Users\\孙悟空'</span><span class="token punctuation">,</span>
  base<span class="token operator">:</span> <span class="token string">'金箍棒.txt'</span><span class="token punctuation">,</span>   <span class="token comment">// 该属性可以用于修改文件名和后缀</span>
  ext<span class="token operator">:</span> <span class="token string">'.txt'</span><span class="token punctuation">,</span>
  name<span class="token operator">:</span> <span class="token string">'金箍棒'</span> <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>__注意:path对象是方便我们操作路径的,对于获取来讲: parse解析成对象,format转换成字符串.join拼接并修正....</li> <li>对于修改路径对象来讲,可以用base属性更改,不能用name,ext更改__</li></ul> <h2 id="node-js是什么"><a href="#node-js是什么" class="header-anchor">#</a> Node.js是什么?</h2> <ul><li>阻塞I/O时进程休眠等待I/O完成后进行下一步(input/outpt)</li> <li>非阻塞:I/O时函数立即返回,进程不等待I/O完成</li> <li>在处理高并发,I/O密集场景性能优势明显</li></ul> <h3 id="事件驱动"><a href="#事件驱动" class="header-anchor">#</a> 事件驱动</h3> <ul><li>I/O等异步操作结束后的通知</li> <li>观察者网模式</li></ul> <h3 id="cpu密集-vs-i-o密集"><a href="#cpu密集-vs-i-o密集" class="header-anchor">#</a> CPU密集 VS I/O密集</h3> <ul><li>CPU: 压缩,解压,加密,解密</li> <li>I/O: 文件操作,网络操作,数据库</li></ul> <h3 id="web常见场景"><a href="#web常见场景" class="header-anchor">#</a> web常见场景</h3> <ul><li>静态资源读取</li> <li>数据库操作</li> <li>渲染页面</li></ul> <h3 id="高并发应对之道"><a href="#高并发应对之道" class="header-anchor">#</a> 高并发应对之道</h3> <ul><li><p>增加机器数</p></li> <li><p>增加每台机器的CPU</p></li> <li><p><code>进程</code>:计算机中程序关于某数据集合上的一次运动活动,是系统进行资源分配和调度的基本单位;(一个运行的程序)</p></li> <li><p><code>多进程</code>:启动多个进程,多个进程同时执行多个任务.</p></li> <li><p><code>线程</code>:进程内的一个相对独立的,可调度的执行单元,与同属一个进程的线程共享进程的资源;</p></li> <li><p><code>多线程</code>:启动多个线程,多个线程同时执行多个任务</p></li></ul> <h3 id="常用场景"><a href="#常用场景" class="header-anchor">#</a> 常用场景</h3> <ul><li>web Server</li> <li>本地代码构建</li> <li>实用工具开发</li></ul> <h2 id="nodejs工作模型"><a href="#nodejs工作模型" class="header-anchor">#</a> NodeJs工作模型</h2> <img src="初学Node-js/node工作模型.jpg"> <h3 id="nodejs的单线程"><a href="#nodejs的单线程" class="header-anchor">#</a> NodeJS的单线程</h3> <ul><li>单线程只是针对主进程,I/O操作系统底层多线程调度</li> <li>单线程不是单进程</li></ul> <h2 id="commonsjs"><a href="#commonsjs" class="header-anchor">#</a> CommonsJS</h2> <ul><li>每个文件是一个模块,有自己的作用域</li> <li>在文件内部的module变量代表模块本身</li> <li>moduke.exports 属性代表模块对外接口(输出)</li></ul> <h2 id="require规则"><a href="#require规则" class="header-anchor">#</a> require规则</h2> <ul><li><code>/</code>表示绝对路径,<code>./</code>表示相对与当前文件的相对路径</li> <li>支持js,json,node拓展名,不写依次尝试</li> <li>不写路径则认为是build-in模块或者各级node_modules内的第三方模块</li></ul> <h3 id="require特性"><a href="#require特性" class="header-anchor">#</a> require特性</h3> <ul><li>module被加载的时候执行,加载后缓存</li> <li>一旦某个模块被循环加载,只输出已经执行的部分,还未执行的部分不会输出</li></ul> <h2 id="fs案例"><a href="#fs案例" class="header-anchor">#</a> FS案例</h2> <ul><li>修正路径 <code>path.resolve(process.agrv[2])</code></li> <li>判断路劲是否存在 <code>fs.accessSync(....,fs.contants.F_ok)</code></li> <li>判断文件类型：'文件：isFile'，'文件夹i是Directory（）'</li></ul> <h3 id="npm-包位置"><a href="#npm-包位置" class="header-anchor">#</a> npm 包位置</h3> <ul><li>npm root -g</li> <li>获取加载中某个包的入口：<code>require.resolve('xxx')</code></li></ul> <h2 id="http"><a href="#http" class="header-anchor">#</a> HTTP</h2> <ul><li>创建服务器</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'http'</span><span class="token punctuation">)</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> http<span class="token punctuation">.</span><span class="token function">createServer</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'request'</span><span class="token punctuation">,</span><span class="token punctuation">(</span>req<span class="token punctuation">,</span>res<span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span>'llll<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'端口8888'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>'res.setHeader' 一次写入</li> <li><code>res.writeHead(200,{'d':'d'})</code> 多次写入</li> <li><code>res.writeHead(200,{'content-type':'text/html';charset=url-8'})</code></li></ul> <h2 id="express框架"><a href="#express框架" class="header-anchor">#</a> express框架</h2> <ul><li>res.json() 响应数据,最常用 , 返回ajax数据</li> <li>redirect() 重定向</li> <li>download() 下载</li> <li>jsonp()    跨域处理</li> <li>res.sendFile()    显示一个文件</li> <li>res.sendStatus    响应状态码</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'express'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// - 1:获取路由中间件对象 let router = express.Router();</span>
<span class="token keyword">let</span> router <span class="token operator">=</span> express<span class="token punctuation">.</span><span class="token function">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// - 2:配置路由规则 router.请求方式(URL,fn事)</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/json'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'jack'</span><span class="token punctuation">}</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// res.end只能响应string||读文件中的data Buffer</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/redirect'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/jsonp'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">jsonp</span><span class="token punctuation">(</span><span class="token string">'jack love rose'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/download'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span>res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  res<span class="token punctuation">.</span><span class="token function">download</span><span class="token punctuation">(</span><span class="token string">'./app.js'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 注意文件是如何被下载成功的</span>
  <span class="token comment">// 基于服务器回写的content-type。等头信息</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">//   - fn中参数有req,res,next</span>
<span class="token comment">// - 3:将router加入到应用server.use(router)</span>
server<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">)</span><span class="token punctuation">;</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">8888</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="模板引擎"><a href="#模板引擎" class="header-anchor">#</a> 模板引擎</h3> <ul><li>下载express-art-template art-template</li> <li>app.js
<ul><li>注册一个模板引擎</li> <li><code>app.engine('.html',express-art-template)</code></li> <li>设置漠然渲染引擎app.set('view engine','.html')</li></ul></li></ul> <h2 id="mongodb"><a href="#mongodb" class="header-anchor">#</a> MongoDB</h2> <ul><li><p>一个数据库对应多个集合</p> <ul><li>一个集合对应多个文档对象</li> <li>在mongo中不论是db还是集合，你都无需去创建他</li> <li>直接就当他已经存在，直接Use来使用
<ul><li>use db名称;
<ul><li>接着会被切换到该db中</li> <li><code>db.要创建的集合名称.save({})</code>;这样集合就被创建了</li></ul></li></ul></li></ul></li> <li><p><strong>解决32位异常</strong>
mongod --dbpath=&quot;路径&quot; --journal --storageEngine=mmapv1</p></li> <li><p>启动服务器</p> <ul><li><code>mongod --dbpath &quot;D:/mongodb/db&quot;</code>   //目录一定要存在，自己创建即可</li> <li>尽量设置在非系统盘 <code>C盘生成目录是需要权限的</code></li> <li>如果看到<code>waiting for connections on port 27017</code>说明服务已经启动</li></ul></li> <li><p>客户端连接服务器<strong>另开一个命令行</strong></p> <ul><li><code>mongo</code> 默认连接的是test数据库</li></ul></li> <li><p>查询有哪些数据库</p> <ul><li>查询数据库：<code>show dbs;</code></li> <li>切换数据库: <code>use 数据库名;</code></li></ul></li> <li><p>查询当前db下有哪些集合</p> <ul><li><code>show collections;</code></li></ul></li> <li><p>查询数据：</p> <ul><li><code>db.集合名.find();</code>   //查询出来的是文档对象 document</li> <li><code>db.users.find();</code></li></ul></li> <li><p>添加数据:</p> <ul><li><code>db.集合名.save(对象)</code>   //mongo默认会给我们加入_id作为该文档对象的唯一标识</li> <li><code>db.users.save({contry:'中国',name:'小明',score:77});</code></li></ul></li> <li><p>删除数据:</p> <ul><li><code>db.集合名.remove(条件对象);</code>   //条件匹配就会被删除</li> <li><code>db.users.remove({name:'小明'});</code></li> <li>如果给定一个空对像，会匹配全部</li></ul></li> <li><p>更新数据:</p> <ul><li><code>db.集合名.update({匹配条件对象},{$set:{修改后的对象}});</code></li> <li><code>db.users.update({name:'小明'},{$set:{contry:'印度'}});;</code></li></ul></li></ul> <h3 id="条件查询"><a href="#条件查询" class="header-anchor">#</a> 条件查询</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>练习：
  查询姓名为小明的学生
        db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">'小明'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">;</span>   <span class="token comment">//名字是小明的同学</span>
        db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>score<span class="token operator">:</span><span class="token punctuation">{</span>$gt<span class="token operator">:</span><span class="token number">90</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//查找成绩大于90分$gt</span>
        <span class="token comment">//$lt小于</span>
  查询数学成绩不等于<span class="token number">88</span>的同学
        db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>score<span class="token operator">:</span><span class="token punctuation">{</span>$ne<span class="token operator">:</span><span class="token number">88</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   查询总分大于<span class="token number">200</span>分的所有同学
        db<span class="token punctuation">.</span>users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span>score<span class="token operator">:</span><span class="token punctuation">{</span>$gt<span class="token operator">:</span><span class="token number">200</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="分页"><a href="#分页" class="header-anchor">#</a> 分页</h3> <ul><li><code>db.users.find().skip(3).limit(3);</code></li> <li>db.集合名称.find().跳到3.显示3条
+ limit 0,3</li></ul> <h3 id="排序"><a href="#排序" class="header-anchor">#</a> 排序</h3> <ul><li><code>db.users.find().sort({key:排序方式});</code></li> <li><code>db.users.find().sort({'score':1});</code> //正数代表升序，负数代表降序</li></ul> <h3 id="模糊匹配"><a href="#模糊匹配" class="header-anchor">#</a> 模糊匹配</h3> <ul><li><code>db.users.find({name:{$regex:'小'}});</code></li> <li><code>db.users.find({name:{$regex:'明'}});</code></li> <li>可以结合正则：<code>db.users.find({name:/正则/}})</code></li></ul> <h3 id="聚合函数"><a href="#聚合函数" class="header-anchor">#</a> 聚合函数</h3> <ul><li>需要求当前集合的记录数：</li> <li><code>db.users.find().count();</code></li> <li>求最大值
-求整个集合的总成绩
+ db.集合名.聚合({ 组的划分规则{_id:'1',显示内容:{$sum:'$score'}} })
<ul><li>求所有人的平均分
<ul><li><code>db.users.aggregate({$group:{_id:'1',sumscore:{$avg:'$score' } }});</code></li></ul></li> <li>求按国家分组，求所有国家的总分
<ul><li><code>db.users.aggregate({$group:{_id:'$contry',sumScore:{$sum:'$score'}}});</code></li></ul></li></ul></li> <li>添加基础数据:
db.users.save({contry:'中国',name:'小明',score:77});
db.users.save({contry:'中国',name:'小红',score:88});
db.users.save({contry:'中国',name:'小张',score:99});
db.users.save({contry:'美国',name:'jack',score:45});
db.users.save({contry:'美国',name:'rose',score:67});
db.users.save({contry:'美国',name:'mick',score:89});</li></ul> <h3 id="联合查询"><a href="#联合查询" class="header-anchor">#</a> 联合查询</h3> <div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>orders<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;item&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;almonds&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;price&quot;</span> <span class="token operator">:</span> <span class="token number">12</span><span class="token punctuation">,</span> <span class="token string">&quot;quantity&quot;</span> <span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;item&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;pecans&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;price&quot;</span> <span class="token operator">:</span> <span class="token number">20</span><span class="token punctuation">,</span> <span class="token string">&quot;quantity&quot;</span> <span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">3</span>  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>inventory<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;almonds&quot;</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">&quot;product 1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;instock&quot;</span> <span class="token operator">:</span> <span class="token number">120</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;bread&quot;</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">&quot;product 2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;instock&quot;</span> <span class="token operator">:</span> <span class="token number">80</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;cashews&quot;</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">&quot;product 3&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;instock&quot;</span> <span class="token operator">:</span> <span class="token number">60</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span> <span class="token operator">:</span> <span class="token string">&quot;pecans&quot;</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">&quot;product 4&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;instock&quot;</span> <span class="token operator">:</span> <span class="token number">70</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token string">&quot;sku&quot;</span><span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span> description<span class="token operator">:</span> <span class="token string">&quot;Incomplete&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
   <span class="token punctuation">{</span> <span class="token string">&quot;_id&quot;</span> <span class="token operator">:</span> <span class="token number">6</span> <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span>orders<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
   <span class="token punctuation">{</span>
     $lookup<span class="token operator">:</span>
       <span class="token punctuation">{</span>
         <span class="token keyword">from</span><span class="token operator">:</span> <span class="token string">&quot;inventory&quot;</span><span class="token punctuation">,</span>
         localField<span class="token operator">:</span> <span class="token string">&quot;item&quot;</span><span class="token punctuation">,</span>
         foreignField<span class="token operator">:</span> <span class="token string">&quot;sku&quot;</span><span class="token punctuation">,</span>
         <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">&quot;inventory_docs&quot;</span>
       <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="操作符"><a href="#操作符" class="header-anchor">#</a> 操作符</h3> <ul><li>https://docs.mongodb.com/manual/reference/operator/</li></ul> <h3 id="配置https"><a href="#配置https" class="header-anchor">#</a> 配置https</h3> <ul><li>公钥  公开的加密方式</li> <li>私钥  存在服务器的唯一解公钥加密的方式</li> <li>签名  确保数据的一致性</li> <li>证书  确保当前发送数据单位可信</li></ul> <h3 id="扩展知识（使用mongodb实现附近的人）"><a href="#扩展知识（使用mongodb实现附近的人）" class="header-anchor">#</a> 扩展知识（使用mongodb实现附近的人）</h3> <ul><li><img src="assets/location.jpg" alt="location"></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 创建索引</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">createIndex</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token string">&quot;sp&quot;</span><span class="token operator">:</span><span class="token string">&quot;2dsphere&quot;</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">,</span>sp<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">105.754</span><span class="token punctuation">,</span><span class="token number">41.689</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;B&quot;</span><span class="token punctuation">,</span>sp<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">105.304</span><span class="token punctuation">,</span><span class="token number">41.783</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;C&quot;</span><span class="token punctuation">,</span>sp<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">105.084</span><span class="token punctuation">,</span><span class="token number">41.389</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;D&quot;</span><span class="token punctuation">,</span>sp<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">105.831</span><span class="token punctuation">,</span><span class="token number">41.285</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;E&quot;</span><span class="token punctuation">,</span>sp<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">106.128</span><span class="token punctuation">,</span><span class="token number">42.086</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;F&quot;</span><span class="token punctuation">,</span>sp<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">105.431</span><span class="token punctuation">,</span><span class="token number">42.009</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
 db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token punctuation">{</span>name<span class="token operator">:</span><span class="token string">&quot;G&quot;</span><span class="token punctuation">,</span>sp<span class="token operator">:</span><span class="token punctuation">{</span>type<span class="token operator">:</span><span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>coordinates<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">104.705</span><span class="token punctuation">,</span><span class="token number">41.921</span><span class="token punctuation">]</span><span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="查找附近的人"><a href="#查找附近的人" class="header-anchor">#</a> 查找附近的人</h3> <ul><li><div class="language-js line-numbers-mode"><pre class="language-js"><code>  db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>
    <span class="token punctuation">{</span>
     sp<span class="token operator">:</span>
       <span class="token punctuation">{</span>
        $nearSphere <span class="token operator">:</span>
          <span class="token punctuation">{</span>
            $geometry<span class="token operator">:</span> <span class="token punctuation">{</span> 
              type<span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span>  
              coordinates<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">105.304</span><span class="token punctuation">,</span><span class="token number">41.783</span><span class="token punctuation">]</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            $minDistance<span class="token operator">:</span> <span class="token number">25000</span><span class="token punctuation">,</span>
            $maxDistance<span class="token operator">:</span> <span class="token number">40000</span>
          <span class="token punctuation">}</span>
       <span class="token punctuation">}</span>
   <span class="token punctuation">}</span>
<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div></li></ul> <h3 id="离我最近"><a href="#离我最近" class="header-anchor">#</a> 离我最近</h3> <ul><li><div class="language-js line-numbers-mode"><pre class="language-js"><code>db<span class="token punctuation">.</span>test<span class="token punctuation">.</span><span class="token function">aggregate</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      $geoNear<span class="token operator">:</span> <span class="token punctuation">{</span>
        near<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> <span class="token string">&quot;Point&quot;</span><span class="token punctuation">,</span> coordinates<span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">105.304</span><span class="token punctuation">,</span><span class="token number">41.783</span><span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        distanceField<span class="token operator">:</span> <span class="token string">&quot;dist.calculated&quot;</span><span class="token punctuation">,</span>
        spherical<span class="token operator">:</span><span class="token boolean">true</span><span class="token punctuation">,</span>
        maxDistance<span class="token operator">:</span> <span class="token number">40000</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li><p>经纬度查询网站</p> <ul><li>http://www.gpsspg.com/maps.htm</li></ul></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/pages/JavaScript/JS_RegExp.html" class="prev">
        🍦 JS正则
      </a></span> <span class="next"><a href="/pages/Interview/FE_Interview.html">
        🐷 前端面试技巧
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ac713374.js" defer></script><script src="/assets/js/2.0cae008b.js" defer></script><script src="/assets/js/25.98184248.js" defer></script>
  </body>
</html>
